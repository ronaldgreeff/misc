(function(window,document){var $=window.jQuery;var SLI=window.SLI=window.SLI||{};var SUGGESTION_CLASS="sli_ac_sugg";var ESCAPE_REGEX=/([.*+?^=!:${}()|[\]\/\\])/g;var keyCode={TAB:9,RETURN:13,ESC:27,PAGEUP:33,PAGEDOWN:34,END:35,LEFT:37,UP:38,RIGHT:39,DOWN:40,DEL:46};var optionMap={productCount:"cnt",currencySymbol:"curr",thumbSize:"thumb"};if(!Function.prototype.bind){Function.prototype.bind=function(context){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")
}function NOP(){}var slice=[].slice,args=slice.call(arguments,1),target=this,boundFn=function(){return target.apply(this instanceof NOP?this:context||window,args.concat(slice.call(arguments)))};NOP.prototype=this.prototype;boundFn.prototype=new NOP();return boundFn}}function mouseEnter(fn){return function(event){var related=event.relatedTarget;if(related&&(this===related||this.contains(related))){return}fn.call(this,event)}}function _stdEvent(event){if(!event.target){event.target=event.srcElement||document}if(!event.preventDefault){event.preventDefault=function(){event.returnValue=false
}}if(!event.stopPropagation){event.stopPropagation=function(){event.cancelBubble=false}}return event}var addEventListener=(function(){if(Element.prototype.addEventListener){var docEl=document.documentElement;if("onmouseenter" in docEl&&"onmouseleave" in docEl){return function(el,eventName,listener){el.addEventListener(eventName,listener)}}return function(el,eventName,listener){if(eventName==="mouseenter"){eventName="mouseover";listener=mouseEnter(listener)}else{if(eventName==="mouseleave"){eventName="mouseout";
listener=mouseEnter(listener)}}el.addEventListener(eventName,listener)}}else{return function(el,eventName,listener){el.attachEvent("on"+eventName,function(event){listener.call(el,_stdEvent(event||window.event))})}}})();function getText(elem){var ret="";var nodeType=elem.nodeType;if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else{if(nodeType===3||nodeType===4){return elem.nodeValue
}}return ret}function throttled(fn){var running=false;var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame;var actualCallback=function(){fn();running=false};if(requestAnimationFrame){return function(){if(!running){running=true;requestAnimationFrame(actualCallback)}}}else{return function(){if(!running){running=true;setTimeout(actualCallback,66)}}}}function highlightTerm(html,values){for(var i=0,length=values.length;i<length;++i){var term=values[i].replace(ESCAPE_REGEX,"\\$1");
if(term!==""){var reg=new RegExp("(>|\\s)("+term+")(?=[^>]*<(?!/h2))","gi");html=html.replace(reg,'$1<span class="highlight">$2</span>')}}return html}function getWidth(){return $(window).width()}function normalise(value){return(value||"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"").replace(/\s{2,}/g," ")}function generateHash(str){var hash=0,chr;for(var i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash|=0}return hash+""}function QueryRequest(url,parent){var self=this;var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;
var script=this.script=document.createElement("script");script.async=true;script.src=url;script.setAttribute("hash",parent.lastRequest);script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(script.parentNode){script.parentNode.removeChild(script)}self.script=null}};head.appendChild(script)}QueryRequest.prototype.abort=function(){var script=this.script;if(script){script.onload(undefined,true)
}};function Autocomplete(options){if(options){this.init(options)}else{throw"need rich autocomplete settings"}this.urls=[];var inputs=this.inputs=[];var el=this.createElement();var st=el.style;var elements=document.querySelectorAll("[data-provide=rac]");var fixed=[];for(var i=0,length=elements.length;i<length;++i){var input=new Input(elements[i],this);inputs.push(input);if(input.isFixed){fixed.push(input.el)}}var self=this;$("#"+this.id).on("click",".sli_ac_suggestion, .sli_ac_product",function(e){setTimeout(self.selectCurrent(e),50)
}).on("click",".close-rac",function(){self.input._onClear()});document.addEventListener("focusout",function(e){self.keepFocus=true});addEventListener(el,"mouseleave",this.resetActive.bind(this));switch(this.width){case"auto":break;case"parent":this.resize=function(){this.position()};break;default:var w=parseInt(this.width,10);if(typeof w!=="number"){w=this.defaults.width}st.width=w+"px"}var recalc=function(){if(this.resize){this.resize()}this.checkScreenSize()};recalc=recalc.bind(this);addEventListener(window,"resize",throttled(recalc));
addEventListener(window,"orientationchange",recalc);if(fixed.length){this.fixed=fixed;var windowScroll=function(){var input=this.input;if(!input||!this.isVisible||!this.fixed||this.fixed.indexOf(input.el)<0){return}if(input.el.offsetWidth===0){this.hide(input.el)}else{recalc()}};addEventListener(window,"scroll",throttled(windowScroll.bind(this)))}this.checkDevice();this.checkScreenSize()}Autocomplete.prototype={id:"sli_autocomplete",tagName:"ul",activeClass:"sli_ac_active",dropdownClass:"sli_ac_dropdown",zIndex:30000,width:"parent",base:"",params:"/search?ts=rac-data&w=",defaults:{width:420},offsetLeft:0,offsetTop:0,align:"left",maxSearchLength:100,isVisible:false,selector:"li li",focus:false,currentSelected:-1,value:undefined,request:null,lastRequest:"",lastSuggestion:"",hoverTimeout:null,lastIndex:-1,input:null,size:null,resize:null,popular:null,breakpoints:{small:{maxWidth:767,value:"s"},other:{maxWidth:undefined,value:"o"}},valueStop:"",stopQuery:false,init:function(options){var i,length;
if(!options.selector){throw"selector not specified"}else{this.selector=options.selector}var sli=window.sli;if(sli&&sli.global&&sli.global.base){this.base=sli.global.base}if(options.params){this.params=options.params}if(options.base){this.base=options.base.replace(/\/+$/,"")+this.params}this.behaviourOptions=$.extend({showProducts:true},options.behaviourOptions);var properties=["tagName","activeClass","dropdownClass","offsetLeft","offsetTop","width","align","maxSearchLength","zIndex"];for(i=0,length=properties.length;
i<length;++i){var prop=properties[i];if(prop in options){this[prop]=options[prop]}}var hooks=["onSelect","onShow","preRequest","postRequest","itemSelected"];for(i=0,length=hooks.length;i<length;++i){var hookName=hooks[i];if(hookName in options&&typeof options[hookName]==="function"){this[hookName]=options[hookName]}}},createElement:function(){var el=this.el=document.createElement(this.tagName);el.id=this.id;el.className="rich";if(this.behaviourOptions.dynamic==="true"){el.className+=" dynamic"}if(this.behaviourOptions.suggestionAlign==="right"){el.className+=" right";
this.align="right"}if(!this.behaviourOptions.suggestionCount){this.behaviourOptions.suggestionCount=5}if(!this.behaviourOptions.productCount){this.behaviourOptions.productCount=4}if(this.screenSize()==="s"){this.behaviourOptions.suggestionCount=this.behaviourOptions.mobileSuggestionCount||2;this.behaviourOptions.searchInCount=this.behaviourOptions.mobileSearchInCount||2;this.behaviourOptions.productCount=this.behaviourOptions.mobileProductCount||4}var st=el.style;st.display="none";st.zIndex=this.zIndex;document.body.appendChild(el);
return el},setInput:function(input){if(this.input!==input||(this.fixed&&this.fixed.indexOf(input.el)>=0)){this.input=input;if(this.resize){this.resize()}}},position:function(){var input=this.input;if(!input){return}if(this.isTablet()){this.scrollToSearchBox()}else{this.stickToTop($(input.el).closest("form"))}var target=input.el;var $input=$(target);var $form=$input.closest("form");var isTargetFixed=this.fixed&&this.fixed.indexOf(target)>=0;var docEl=document.documentElement;var body=document.body;var rect=target.getBoundingClientRect();
var top=rect.top+target.offsetHeight+this.offsetTop;var left=rect.left+this.offsetLeft;var el=this.el;var $rac=$(el);var st=el.style;if(!isTargetFixed){top+=(typeof window.pageYOffset!="undefined"?window.pageYOffset:docEl.scrollTop?docEl.scrollTop:body.scrollTop?body.scrollTop:0);left+=(typeof window.pageXOffset!="undefined"?window.pageXOffset:docEl.scrollLeft?docEl.scrollLeft:body.scrollLeft?body.scrollLeft:0)}if(!$rac.hasClass("is-full-width")){var w=parseInt($form.css("width"));var thumbWidth=50;if(this.isTwoColumnsLayout()){if(this.align==="right"){w=left+target.offsetWidth-thumbWidth;
if(w<target.offsetWidth){w=target.offsetWidth}else{left+=target.offsetWidth-w}}else{w=body.offsetWidth-left-thumbWidth;if(w<target.offsetWidth){w=target.offsetWidth}}}else{if(this.align==="right"){w=left+target.offsetWidth-thumbWidth;if(w<target.offsetWidth){w=target.offsetWidth}else{left+=target.offsetWidth-w}}}st.width=w+"px"}if(this.isStickToTop($form)){st.top=$form.css("height")}else{st.top=top+"px"}st.left=left+"px";st.position=isTargetFixed?"fixed":"absolute";if(!this.hasTouch){input=this.input.el;this._setPositionUnder($(input).siblings("input.suggested-word"),input)
}this.setCloseArea()},_select:function(index){var items=this.items,previous=this.currentSelected,selected=items[index],$selected=$(selected);this.currentSelected=index;if(previous!==index&&previous>=0&&previous<items.length){$(items[previous]).removeClass(this.activeClass)}$selected.addClass(this.activeClass);this._updateActiveSearchSuggestion($selected);var suggestion=$selected.find("[data-suggested-term]");if(suggestion.length>0){var suggestedWord=suggestion.attr("data-suggested-term");if(this.canShowDynamic()){var suggestedFacet=suggestion.attr("data-suggested-facet"),extraHref="skipTemplate=yes";
if(suggestedFacet){extraHref+="&af="+suggestedFacet}this.fireRequest(suggestedWord,extraHref)}else{this._updateSuggestion(suggestedWord)}}if(this.itemSelected){this.itemSelected(selected)}},canShowDynamic:function(){return !this.hasTouch&&this.behaviourOptions.dynamic==="true"&&this.screenSize()!=="s"},isTwoColumnsLayout:function(){return this.canShowDynamic()||this.isTablet()},_updateActiveSearchSuggestion:function($selected){if(!this.canShowDynamic()){$(".sli_ac_suggestion").removeClass("is-active");return
}if($selected.hasClass("sli_ac_suggestion")){$(".sli_ac_suggestion").removeClass("is-active");$selected.addClass("is-active")}},moveSelect:function(steps){var max=this.items.length-1;var index=this.currentSelected+steps;if(index<0){index=0}else{if(index>max){index=max}}this._select(index)},next:function(){this.moveSelect(1)},prev:function(){this.moveSelect(-1)},pageDown:function(){this.moveSelect(10)},pageUp:function(){this.moveSelect(-10)},show:function(){var el=this.el;var display;if(!this.isVisible&&this.onShow){display=this.onShow(el)
}if(display!==false){el.style.display="block";this.isVisible=true;if(this.input){$(this.input.el).addClass(this.dropdownClass)}}var $suggestionsColumn=$(".sli_ac_suggestions");if(this.isTwoColumnsLayout()){var minHeight=this.behaviourOptions.minHeight,searchSuggestionsHeight=$(".sli_ac_suggestions").css("height");if(!minHeight||parseInt(minHeight)<parseInt(searchSuggestionsHeight)){minHeight=searchSuggestionsHeight}$(".productList").css({"min-height":minHeight});$suggestionsColumn.removeClass("is-hidden")}else{if(!$(".sli_ac_suggestion").length){$suggestionsColumn.removeClass("is-hidden").addClass("is-hidden")
}}this.position()},setCloseArea:function(){var $rac=$(this.el),$closeArea=$rac.siblings(".sli-close-area"),self=this;if($closeArea.length){$closeArea.removeClass("is-hidden")}else{$closeArea=$('<div class="js-sli-close-area sli-close-area"></div>');$closeArea.insertAfter($rac);$closeArea.off("click").on("click",function(){self.input._onClear()})}},hide:function(input){this.el.style.display="none";this.isVisible=false;if(input){var $input=$(input.el);$input.removeClass(this.dropdownClass);this._setSuggestionInput("",$input)
}},selectCurrent:function(e){var i=this.currentSelected;var target=this.input.el;var q=target.value;var param={};var url;if(i===-1&&e){i=$(".sli_ac_suggestion").index($(e.target))}if(i===-1){this.hide(this.input);if(!q||q.length===0||!q.trim()){return false}param.url=this.base.replace("ts=rac-data&","")+encodeURIComponent(q.trim());$(this.input.el).closest("form").submit();return true}else{url=this.urls[i]+"&asug="+encodeURIComponent(q.trim());param={url:url,query:q};if(url.indexOf("rt=racsug")>=0){param.type="suggestion"
}else{if(url.indexOf("rt=racclick")>=0){param.type="product"}}if(this.onSelect){param=this.onSelect(param)}if(!param){return false}var item=this.items[i];if(target&&item){item=item.getElementsByClassName?item.getElementsByClassName(SUGGESTION_CLASS)[0]:item.querySelector("."+SUGGESTION_CLASS);if(item){target.value=normalise(getText(item))}}}this.hide(this.input);document.location=param.url+(param.url.match(/[#?]/)?"&":"?")+"apelog=yes";return true},_mouseOver:function(index){var current=this.currentSelected;
if(index<0||index===current||!this.isVisible){return}this._select(index)},_mouseOut:function(){this.resetActive()},stopRequest:function(){if(this.request!==null){this.request.abort()}},_setPositionUnder:function($bottomElem,topElem){if(!$bottomElem.length||!topElem){return}if(topElem.length){topElem=topElem[0]}var $topElem=$(topElem);if(parseInt($topElem.css("z-index"))<1){$topElem.addClass("z-index-1")}var rect=topElem.getBoundingClientRect();$bottomElem.css({height:rect.height+"px",position:"absolute",width:rect.width+"px","z-index":parseInt($topElem.css("z-index"))-1});
if($topElem.parent().css("position")==="relative"){$bottomElem.css({left:0,top:0})}else{var offset=$topElem.offset();$bottomElem.css({left:offset.left,top:offset.top})}return $bottomElem},_setSuggestionInput:function(suggestion,$input){if(this.hasTouch){return}if(this.screenSize()==="s"){suggestion=""}var $suggestionInput=$input.siblings("input.suggested-word");if(!$suggestionInput.length){if(suggestion===""){return}$suggestionInput=$('<input type="search" class="suggested-word" disabled />');$suggestionInput.addClass($input.get(0).className);
$suggestionInput.css({"font-size":$input.css("font-size")});this._setPositionUnder($suggestionInput,$input);$suggestionInput.insertAfter($input)}$suggestionInput.val(suggestion);this.placeholder=this.placeholder||$input.attr("placeholder");if(suggestion===""){$suggestionInput.addClass("is-hidden");$input.attr("placeholder",this.placeholder)}else{$suggestionInput.removeClass("is-hidden");$input.attr("placeholder","")}},_completeWord:function(term,suggestion){if(suggestion.toLowerCase().indexOf(term.toLowerCase())!==0){return""
}var completion=suggestion.substring(term.length);if(completion!==""){var uppers=term.match(/[A-Z]/g);if(uppers&&uppers.length/term.length>0.5){completion=completion.toUpperCase()}}return term+completion},addRACData:function(data){var self=this;if(this.lastRequest!==data.requested){return}if(data.template!==""){this.el.innerHTML=data.template;var suggestions=jQuery(".sli_ac_suggestions ul").html();jQuery(".sli_ac_suggestions ul").html(highlightTerm(suggestions,this.input.el.value.trim().split(/\s+/)))}var $el=$(this.el);
Object.keys(data.content).forEach(function(key){$el.find("."+key).html(data.content[key])});if(typeof data.suggestion!=="undefined"&&data.suggestion!==""){this.lastSuggestion=data.suggestion.toLowerCase();var value=this._productSuggestionTitle(this.behaviourOptions.productLabel,this.lastSuggestion);$(".sli_ac_products .sli_ac_section").text(value)}this.setHover();this.items=this.el.querySelectorAll(this.selector);this.urls=jQuery(this.selector).map(function(){return jQuery(this).find('a[data-role="main-link"]').attr("href")||jQuery(this).find("a").attr("href")
});if(!this.canShowDynamic()){this.currentSelected=-1}$(".sli_suggestion_arrow").on("click",function(e){e.stopPropagation();var $suggestion=$(this).closest("li").find("[data-suggested-term]");if($suggestion.length){$(self.input.el).val($suggestion.attr("data-suggested-term")).focus();self.keepFocus=true}});this.displayRAC()},setHover:function(){var self=this;if(this.canShowDynamic()){$(".sli_ac_suggestions li").on("mouseover",function(e){var target=e.target||e.srcElement;self.lastIndex=$(".sli_ac_suggestions li").index($(target).closest("li"));
if(!self.hoverTimeout){self.hoverTimeout=setTimeout(function(){window.clearTimeout(self.hoverTimeout);self.hoverTimeout=null;if(self.currentSelected!==self.lastIndex){self._mouseOver(self.lastIndex)}},500)}});$(".sli_ac_product").on("mouseover",function(){var index=$(".sli_ac_suggestions li").length+$(".sli_ac_product").index(this);self._select(index);window.clearTimeout(self.hoverTimeout);self.hoverTimeout=null})}else{var $selector=$(this.selector);$selector.off("mouseover").on("mouseover",function(){self._mouseOver($selector.index(this))
}).off("mouseout").on("mouseout",function(){self._mouseOut.bind(self)})}},hasRAC:function(){return this.behaviourOptions.showEmpty==="true"||($(this.el).find(".productList").length&&this.input&&$(this.input.el).val().length)},displayRAC:function(){if(!this.hasRAC()){return}this._updateSuggestion(this.lastSuggestion);this.show();$(".loader").removeClass("loading");this.valueStop="";this.stopQuery=false;if(this.isStickToTop($(this.input.el).closest("form"))){window.scrollTo(0,1)}},_updateSuggestion:function(suggestion){var $input=$(this.input.el),term=$input.val(),completion="";
if(term!==""&&typeof suggestion!=="undefined"&&suggestion!==""){completion=this._completeWord(term,suggestion)}this._setSuggestionInput(completion,$input)},doRequest:function(val){var noResultVal=this.valueStop||"";if(val.length>this.maxSearchLength){return false}if(val===this.value&&this.hasRAC()){this.displayRAC();return false}if(this.stopQuery&&val.length>noResultVal.length&&val.substr(0,noResultVal.length)==noResultVal){return false}return true},outOfFocus:function(input){if(this.keepFocus){this.keepFocus=false;
return}this.focus=false;this.hide(input);this.resetActive();this.resetStickToTop($(input.el).closest("form"))},_productSuggestionTitle:function(label,keyword){var value=label;if(keyword!=="*"){value+=' for "'+keyword+'"'}if(this.currentSelected>=0){var $suggestion=$(this.items[this.currentSelected]).find("[data-suggested-term]");var scope=$suggestion.find(".scope").text();if(scope){value+=" in "+scope}}return value},fireRequest:function(word,extraHref){this.stopRequest();var keyword=word?word:this.value;var url=this.base+encodeURIComponent(keyword)+"&rt=rac&dv="+this.size;
var self=this;$.each(this.behaviourOptions,function(key,value){if(key==="productLabel"){value=self._productSuggestionTitle(value,keyword);$(".sli_ac_products .sli_ac_section").text(value)}key=optionMap[key]||key;url+="&"+encodeURIComponent(key)+"="+encodeURIComponent(value)});if(extraHref){url+="&"+extraHref}url=this.preRequest?this.preRequest(url):url;var thisRequest=generateHash(url).toString();url+="&requested="+thisRequest;if(thisRequest!==this.lastRequest){this.request=new QueryRequest(url,this);this.lastRequest=thisRequest;
$(".loader").addClass("loading")}else{this.displayRAC()}},resetActive:function(){var current=this.currentSelected;var items=this.items;if(current>=0&&current<items.length){$(items[current]).removeClass(this.activeClass)}this.currentSelected=-1},valueChanged:function(input,value){this.setInput(input);if(!this.doRequest(value)){return}this.value=value;if(value.length===0){this.stopRequest();this.hide(input);if(!this.hasRAC()){this.resetStickToTop($(input.el).closest("form"))}}else{this.fireRequest();this.resetActive()
}},inFocus:function(input){this.resetActive();this.focus=true;if(this.isTablet()){this.scrollToSearchBox()}if(input!==this.input){this.hide(this.input);this.setInput(input)}else{this.displayRAC()}if(this.input.el.value!==""){this.fireRequest(this.input.el.value)}else{if((this.input.el.value==="")&&(this.behaviourOptions.showEmpty==="true")){this.fireRequest("*")}}},checkScreenSize:function(){var size=this.screenSize();if(size!==this.size){this.size=size;if(this.isVisible&&this.value&&this.value.length>0){this.fireRequest()
}}},screenSize:function(){var bp=this.breakpoints;return(getWidth()<bp.small.maxWidth)?bp.small.value:bp.other.value},resetStickToTop:function($form){if(!this.isStickToTop($form)){return}$("body").removeClass("full-width");$(this.el).removeClass("is-full-width");$form.removeClass("sticky sticky--full-width");window.scrollTo(0,0)},isStickToTop:function($elem){return $elem.is(".sticky, .sticky--full-width")},canStickToTop:function(){return this.hasTouch&&this.focus&&this.hasRAC()},stickToTop:function($form){if(this.isStickToTop($form)||!this.canStickToTop()){return
}$(this.el).removeClass("is-full-width");$form.removeClass("sticky sticky--full-width");if(this.screenSize()==="s"){$("body").addClass("full-width");$(this.el).addClass("is-full-width");$form.addClass("sticky--full-width")}else{$form.addClass("sticky")}window.scrollTo(0,1)},isTablet:function(){return this.screenSize()!=="s"&&this.hasTouch},scrollToSearchBox:function(){if(!this.input){return}this.resetStickToTop($(this.input.el).closest("form"));var body=document.body;var rect=this.input.el.getBoundingClientRect();
window.scrollTo(rect.left+body.scrollLeft,rect.top+body.scrollTop)},checkDevice:function(){this.hasTouch=("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch;if(this.hasTouch){var $elems=[$("[data-provide=rac]").closest("form"),$(this.el)];for(var i=0,len=$elems.length;i<len;i++){if(!$elems[i].hasClass("has-touch")){$elems[i].addClass("has-touch")}}}var isSafari=/constructor/i.test(window.HTMLElement);var $body=$("body");if(isSafari&&!$body.hasClass("is-safari")){$body.addClass("is-safari")
}}};function Input(el,autocomplete,options){this.el=el;this.autocomplete=autocomplete;if(options&&options.delay){this.delay=options.delay}el.setAttribute("autocomplete","off");this.isFixed=el.getAttribute("data-sli-position")==="fixed";if(el.hasAttribute("data-sli-width")){this.width=el.getAttribute("data-sli-width")}var proxiedBlur=this._onBlur.bind(this);var delay=this.delay+300;addEventListener(el,"blur",function(){setTimeout(proxiedBlur,delay)});addEventListener(el,"focus",this._onFocus.bind(this));addEventListener(el,"keydown",this._onKeyDown.bind(this));
if(window.opera&&opera.version){var version=opera.version();if(version&&version<11){el.onkeypress=this._onKeyPress.bind(this)}}addEventListener(el,"keyup",this._onKeyUp.bind(this));addEventListener(el,"compositionupdate",this._onCompositionUpdate.bind(this));addEventListener(el,"compositionend",this._onCompositionEnd.bind(this));addEventListener(el,"search",this._onClear.bind(this))}Input.prototype={delay:150,isFixed:false,lastValue:"",timeout:null,isCompositionEnd:false,blockSubmit:false,_onChange:function(value){this._onFocus();
if(!value||typeof(value)!=="string"){value=this.el.value}this.autocomplete.valueChanged(this,normalise(value))},_onBlur:function(){this.autocomplete.outOfFocus(this)},_onFocus:function(){this.autocomplete.inFocus(this)},_onKeyPress:function(){if(this.blockSubmit){this.blockSubmit=false;if(this.autocomplete.isVisible){return false}}},_onKeyDown:function(event){var el=this.el;var autocomplete=this.autocomplete;autocomplete.focus=true;this.blockSubmit=false;var key=event.which!==null?event.which:event.charCode!==null?event.charCode:event.keyCode;
switch(key){case keyCode.UP:event.preventDefault();if(autocomplete.isVisible){autocomplete.prev()}else{this._onChange()}break;case keyCode.DOWN:event.preventDefault();if(autocomplete.isVisible){autocomplete.next()}else{this._onChange()}break;case keyCode.PAGEUP:event.preventDefault();if(autocomplete.isVisible){autocomplete.pageUp()}else{this._onChange()}break;case keyCode.PAGEDOWN:event.preventDefault();if(autocomplete.isVisible){autocomplete.pageDown()}else{this._onChange()}break;case keyCode.LEFT:case keyCode.RIGHT:break;
case keyCode.END:case keyCode.TAB:event.preventDefault();var completion=$(el).siblings("input.suggested-word").val();if(completion&&completion!==""){$(el).val(completion);this._onChange()}break;case keyCode.RETURN:event.preventDefault();if(autocomplete.selectCurrent()){this.blockSubmit=false;return false}autocomplete.stopRequest();if(this.timeout!==null){clearTimeout(this.timeout)}this.lastValue=el.value;if(!this.isCompositionEnd){autocomplete.hide(this)}break;case keyCode.ESC:autocomplete.hide(this);break;default:autocomplete.resetActive();
clearTimeout(this.timeout);break}this.lastValue=el.value},_onKeyUp:function(event){var key=event.which!==null?event.which:event.charCode!==null?event.charCode:event.keyCode;switch(key){case keyCode.ESC:case keyCode.RETURN:if(!this.isCompositionEnd){this.autocomplete.hide(this)}else{this.isCompositionEnd=false}break;default:clearTimeout(this.timeout);if(this.el.value!==this.lastValue||this.el.value===""){this.timeout=setTimeout(this._onChange.bind(this),this.delay)}break}},_onClear:function(event){this.hideKeyboard();
this.autocomplete.keepFocus=false;this._onBlur();var $closeArea=$(".js-sli-close-area");if($closeArea.length){$closeArea.removeClass("is-hidden").addClass("is-hidden")}},hideKeyboard:function(){if(!this.autocomplete.hasTouch){return}var element=$(this.el);element.attr("readonly","readonly");setTimeout(function(){element.blur();element.removeAttr("readonly")},100)},_onCompositionUpdate:function(event){var value=event.data;if(value!==this.lastValue){clearTimeout(this.timeout);this.timeout=setTimeout(this._onChange.bind(this,value),this.delay)
}},_onCompositionEnd:function(){this.isCompositionEnd=true}};SLI.Autocomplete=Autocomplete})(window,document);